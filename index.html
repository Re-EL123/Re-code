<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Re-Code | Re-EL's Advanced Coding AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- React + Babel -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Puter AI -->
<script src="https://js.puter.com/v2/"></script>

<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Monaco Editor -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/editor/editor.main.css" />
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/loader.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,system-ui,sans-serif;background:#0a0e1a;color:#f1f5f9;overflow-x:hidden}
.app{max-width:1600px;margin:auto;padding:20px;position:relative}

/* Header */
header{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);padding:20px 28px;border-radius:20px;margin-bottom:24px;border:1px solid rgba(110,243,197,.2);box-shadow:0 8px 32px rgba(0,0,0,.3);animation:slideDown 0.6s ease}
.brand{display:flex;align-items:center;gap:12px;font-size:1.6rem;font-weight:900;background:linear-gradient(135deg,#6ef3c5,#4ade80);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.brand i{color:#6ef3c5;animation:pulse 2s ease infinite}

/* Credit System */
.credit-section{display:flex;align-items:center;gap:16px}
.credit-display{display:flex;align-items:center;gap:10px;padding:10px 20px;border-radius:14px;background:rgba(110,243,197,.1);border:2px solid rgba(110,243,197,.3);font-weight:700;font-size:1rem;transition:all 0.3s}
.credit-display.warning{background:rgba(251,191,36,.1);border-color:rgba(251,191,36,.5);animation:warningPulse 1.5s ease infinite}
.credit-display.danger{background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.5);animation:dangerPulse 1s ease infinite}
.credit-bar{width:120px;height:8px;background:#020617;border-radius:10px;overflow:hidden;border:1px solid #1e293b}
.credit-fill{height:100%;background:linear-gradient(90deg,#6ef3c5,#4ade80);transition:all 0.5s ease;border-radius:10px}
.credit-fill.warning{background:linear-gradient(90deg,#fbbf24,#f59e0b)}
.credit-fill.danger{background:linear-gradient(90deg,#ef4444,#dc2626)}

/* Main Panel */
.main-panel{background:rgba(255,255,255,.06);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:28px;margin-bottom:24px;box-shadow:0 8px 32px rgba(0,0,0,.3);animation:fadeIn 0.6s ease}
.prompt-section{position:relative}
.prompt-label{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-weight:600;color:#6ef3c5;font-size:1rem}
textarea{width:100%;min-height:140px;background:rgba(2,6,23,.8);color:#e5e7eb;border-radius:16px;border:2px solid #1e293b;padding:16px;resize:vertical;font-size:0.95rem;line-height:1.6;transition:all 0.3s;font-family:inherit}
textarea:focus{outline:none;border-color:#6ef3c5;box-shadow:0 0 0 3px rgba(110,243,197,.1)}
textarea::placeholder{color:#64748b}

/* Token Estimation */
.token-estimate{display:flex;align-items:center;gap:12px;margin-top:12px;padding:12px 16px;background:rgba(110,243,197,.05);border-radius:12px;border:1px solid rgba(110,243,197,.15);font-size:0.9rem;color:#94a3b8}
.token-estimate i{color:#6ef3c5}
.token-cost{font-weight:700;color:#6ef3c5}

/* Actions */
.actions{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
button{padding:14px 24px;border:none;border-radius:14px;font-weight:700;cursor:pointer;font-size:0.95rem;display:flex;align-items:center;gap:8px;transition:all 0.3s;position:relative;overflow:hidden}
button:before{content:"";position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,.2);transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s}
button:hover:before{width:300px;height:300px}
button.primary{background:linear-gradient(135deg,#6ef3c5,#4ade80);color:#000;box-shadow:0 4px 16px rgba(110,243,197,.3)}
button.primary:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(110,243,197,.4)}
button.secondary{background:#020617;color:#e5e7eb;border:2px solid #1e293b}
button.secondary:hover{border-color:#6ef3c5;background:#0a1628}
button:disabled{opacity:.5;cursor:not-allowed;transform:none!important}
button i{z-index:1}
button span{z-index:1}

/* Progress Bar */
.progress-container{margin-top:16px;display:none}
.progress-container.active{display:block;animation:fadeIn 0.3s}
.progress-bar{width:100%;height:6px;background:#020617;border-radius:10px;overflow:hidden;border:1px solid #1e293b}
.progress-fill{height:100%;background:linear-gradient(90deg,#6ef3c5,#4ade80,#6ef3c5);background-size:200% 100%;animation:progressShimmer 2s linear infinite;transition:width 0.3s}
.progress-text{margin-top:8px;font-size:0.85rem;color:#94a3b8;text-align:center}

/* Editor Container */
.editor-container{background:rgba(255,255,255,.06);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:24px;box-shadow:0 8px 32px rgba(0,0,0,.3);animation:fadeIn 0.8s ease}
.editor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.editor-title{display:flex;align-items:center;gap:8px;font-weight:700;color:#6ef3c5;font-size:1.1rem}
.editor-actions{display:flex;gap:8px}
.icon-btn{padding:10px;border:none;background:rgba(110,243,197,.1);border-radius:10px;cursor:pointer;transition:all 0.3s;color:#6ef3c5}
.icon-btn:hover{background:rgba(110,243,197,.2);transform:scale(1.05)}
#editor{height:500px;border-radius:16px;border:2px solid #1e293b;overflow:hidden;box-shadow:inset 0 2px 8px rgba(0,0,0,.3)}

/* Stats */
.stats{display:flex;gap:24px;margin-top:16px;padding:16px;background:rgba(2,6,23,.6);border-radius:12px;border:1px solid #1e293b}
.stat-item{display:flex;align-items:center;gap:8px;font-size:0.9rem;color:#94a3b8}
.stat-item i{color:#6ef3c5}
.stat-value{font-weight:700;color:#e5e7eb}

/* Toast System */
.toast{position:fixed;bottom:24px;right:24px;background:rgba(2,6,23,.95);backdrop-filter:blur(20px);border:2px solid;padding:16px 24px;border-radius:16px;display:flex;align-items:center;gap:12px;font-weight:600;box-shadow:0 8px 32px rgba(0,0,0,.5);animation:slideIn 0.3s ease;z-index:1000;max-width:400px}
.toast.success{border-color:#4ade80;color:#4ade80}
.toast.error{border-color:#ef4444;color:#ef4444}
.toast.warning{border-color:#fbbf24;color:#fbbf24}
.toast.info{border-color:#6ef3c5;color:#6ef3c5}
.toast i{flex-shrink:0}

/* Alert Modal */
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:2000;animation:fadeIn 0.3s}
.modal{background:rgba(2,6,23,.98);border:2px solid;border-radius:20px;padding:32px;max-width:500px;width:90%;box-shadow:0 16px 64px rgba(0,0,0,.7);animation:scaleIn 0.3s ease}
.modal.warning{border-color:#fbbf24}
.modal.danger{border-color:#ef4444}
.modal-header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
.modal-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px}
.modal.warning .modal-icon{background:rgba(251,191,36,.2);color:#fbbf24}
.modal.danger .modal-icon{background:rgba(239,68,68,.2);color:#ef4444}
.modal-title{font-size:1.4rem;font-weight:800}
.modal-body{color:#94a3b8;line-height:1.6;margin-bottom:24px}
.modal-actions{display:flex;gap:12px}

/* Animations */
@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
@keyframes slideIn{from{opacity:0;transform:translateX(100px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
@keyframes warningPulse{0%,100%{box-shadow:0 0 0 0 rgba(251,191,36,.4)}50%{box-shadow:0 0 0 8px rgba(251,191,36,0)}}
@keyframes dangerPulse{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.4)}50%{box-shadow:0 0 0 8px rgba(239,68,68,0)}}
@keyframes progressShimmer{0%{background-position:0% 0}100%{background-position:200% 0}}

/* Responsive */
@media(max-width:768px){
  header{flex-direction:column;gap:16px}
  .actions{flex-direction:column}
  button{width:100%;justify-content:center}
  .stats{flex-direction:column;gap:12px}
  #editor{height:400px}
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useRef}=React;

function cleanCode(raw){
  return raw.replace(/```[\s\S]*?```/g,m=>m.replace(/```[\w]*\n?|```/g,""))
            .replace(/```/g,"")
            .trim();
}

function detectLanguage(code){
  if(code.startsWith("<!DOCTYPE")||code.startsWith("<html"))return"html";
  if(/import React|from ['"]react['"]/.test(code))return"javascript";
  if(/def\s+\w+\(/.test(code))return"python";
  if(/System\.out\.print|public\s+class/.test(code))return"java";
  if(/#include\s*<|using namespace/.test(code))return"cpp";
  if(/func\s+\w+\(|let\s+\w+:/.test(code))return"swift";
  if(/fn\s+\w+\(|impl\s/.test(code))return"rust";
  return"plaintext";
}

function estimateTokens(text){
  return Math.ceil(text.length/4);
}

function App(){
  const [prompt,setPrompt]=useState("");
  const [loading,setLoading]=useState(false);
  const [credits,setCredits]=useState(100);
  const [maxCredits]=useState(100);
  const [toast,setToast]=useState(null);
  const [modal,setModal]=useState(null);
  const [progress,setProgress]=useState(0);
  const [generatedChars,setGeneratedChars]=useState(0);
  const [language,setLanguage]=useState("plaintext");
  const editorRef=useRef(null);
  const monacoRef=useRef(null);

  useEffect(()=>{
    lucide.createIcons();
    require.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}});
    require(["vs/editor/editor.main"],(monaco)=>{
      monacoRef.current=monaco;
      editorRef.current=monaco.editor.create(document.getElementById("editor"),{
        value:"// Your generated code will appear here\n// Ready to create something amazing!",
        language:"plaintext",
        theme:"vs-dark",
        automaticLayout:true,
        minimap:{enabled:false},
        fontSize:14,
        lineHeight:22,
        fontFamily:"'Fira Code', 'Cascadia Code', Consolas, monospace",
        padding:{top:16,bottom:16}
      });
    });
  },[]);

  function showToast(msg,type="info"){
    setToast({msg,type});
    setTimeout(()=>setToast(null),4000);
  }

  function showModal(title,body,type,onConfirm){
    setModal({title,body,type,onConfirm});
  }

  function closeModal(){
    setModal(null);
  }

  const estimatedCost=Math.ceil(estimateTokens(prompt)/10);
  const creditPercent=(credits/maxCredits)*100;
  const creditStatus=creditPercent<=20?"danger":creditPercent<=50?"warning":"normal";

  async function generate(){
    if(!prompt.trim()){
      showToast("Please enter a prompt to generate code","warning");
      return;
    }

    const estimatedCost=Math.ceil(estimateTokens(prompt)/10);
    
    if(credits<=0){
      showModal(
        "No Credits Remaining",
        "You've run out of credits and cannot generate code. Please reset your credits or wait for them to replenish.",
        "danger",
        null
      );
      return;
    }

    if(credits<estimatedCost){
      showModal(
        "Insufficient Credits",
        `This generation will cost approximately ${estimatedCost} credits, but you only have ${credits} credits remaining. The generation may be cut short.`,
        "warning",
        ()=>continueGeneration()
      );
      return;
    }

    if(credits<=20){
      showModal(
        "Low Credits Warning",
        `You have ${credits} credits remaining. This generation will cost approximately ${estimatedCost} credits. Continue anyway?`,
        "warning",
        ()=>continueGeneration()
      );
      return;
    }

    continueGeneration();
  }

  async function continueGeneration(){
    closeModal();
    setLoading(true);
    setProgress(0);
    setGeneratedChars(0);
    
    let buffer="";
    const system="You are an expert code generator. Return strictly code only, fully complete and functional. No markdown formatting, no explanations, no text outside code. Ensure the code is production-ready.";

    try{
      const progressInterval=setInterval(()=>{
        setProgress(p=>Math.min(p+1,95));
      },100);

      const res=await puter.ai.chat([
        {role:"system",content:system},
        {role:"user",content:prompt}
      ],{model:"claude-sonnet-4-20250514",stream:true});

      let chunkCount=0;
      for await(const part of res){
        const text=part?.text||"";
        buffer+=text;
        chunkCount++;
        
        const cleaned=cleanCode(buffer);
        setGeneratedChars(cleaned.length);
        editorRef.current.setValue(cleaned);

        if(chunkCount%10===0){
          const currentCost=Math.ceil(cleaned.length/150);
          if(credits-currentCost<=0){
            showToast("Credits exhausted during generation!","warning");
            break;
          }
        }
      }

      clearInterval(progressInterval);

      // Auto-continue if code seems incomplete
      if(buffer.length>100&&!/[}\);>\]]$/.test(buffer.trim())){
        showToast("Continuing generation...","info");
        
        const cont=await puter.ai.chat([
          {role:"system",content:system},
          {role:"user",content:"Continue the code exactly where you stopped. Complete it fully."}
        ],{model:"claude-sonnet-4-20250514",stream:true});

        for await(const part of cont){
          buffer+=part?.text||"";
          const cleaned=cleanCode(buffer);
          setGeneratedChars(cleaned.length);
          editorRef.current.setValue(cleaned);
        }
      }

      const final=cleanCode(buffer);
      const lang=detectLanguage(final);
      setLanguage(lang);
      monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(),lang);

      const totalCost=Math.ceil(final.length/150);
      const newCredits=Math.max(credits-totalCost,0);
      setCredits(newCredits);
      
      setProgress(100);
      showToast(`Code generated successfully! Used ${totalCost} credits.`,"success");

      if(newCredits<=20&&newCredits>0){
        setTimeout(()=>{
          showModal(
            "Low Credits Alert",
            `You now have only ${newCredits} credits remaining. You may want to be mindful of your usage.`,
            "warning",
            null
          );
        },2000);
      }

    }catch(e){
      showToast("Generation failed: "+e.message,"error");
    }
    
    setLoading(false);
    setProgress(0);
  }

  function copyCode(){
    const code=editorRef.current.getValue();
    navigator.clipboard.writeText(code);
    showToast("Code copied to clipboard!","success");
  }

  function downloadCode(){
    const code=editorRef.current.getValue();
    const extensions={
      javascript:"js",html:"html",python:"py",
      java:"java",cpp:"cpp",rust:"rs",swift:"swift"
    };
    const ext=extensions[language]||"txt";
    const blob=new Blob([code],{type:"text/plain"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download=`generated-code.${ext}`;
    a.click();
    URL.revokeObjectURL(url);
    showToast("Code downloaded!","success");
  }

  function resetEditor(){
    editorRef.current.setValue("// Your generated code will appear here\n// Ready to create something amazing!");
    setLanguage("plaintext");
    monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(),"plaintext");
    setGeneratedChars(0);
    showToast("Editor reset","info");
  }

  function resetCredits(){
    setCredits(100);
    showToast("Credits reset to 100","success");
  }

  return(
    <div className="app">
      <header>
        <div className="brand">
          <i data-lucide="code-2"></i>
          Re-Code AI
        </div>
        <div className="credit-section">
          <div className={`credit-display ${creditStatus}`}>
            <i data-lucide="zap"></i>
            <span>{credits} Credits</span>
          </div>
          <div className="credit-bar">
            <div className={`credit-fill ${creditStatus}`} style={{width:`${creditPercent}%`}}></div>
          </div>
          <button className="icon-btn" onClick={resetCredits} title="Reset Credits">
            <i data-lucide="refresh-cw"></i>
          </button>
        </div>
      </header>

      <div className="main-panel">
        <div className="prompt-section">
          <div className="prompt-label">
            <i data-lucide="message-square"></i>
            What would you like to build?
          </div>
          <textarea 
            value={prompt} 
            onChange={e=>setPrompt(e.target.value)} 
            placeholder="Example: Create a todo list app with React that saves to localStorage, uses modern UI design with animations..."
            disabled={loading}
          />
          {prompt&&(
            <div className="token-estimate">
              <i data-lucide="info"></i>
              <span>Estimated cost: <span className="token-cost">~{estimatedCost} credits</span></span>
              <span>â€¢</span>
              <span>Remaining after: <span className="token-cost">{Math.max(credits-estimatedCost,0)} credits</span></span>
            </div>
          )}
        </div>

        <div className="actions">
          <button className="primary" onClick={generate} disabled={loading||!prompt.trim()}>
            <i data-lucide={loading?"loader":"sparkles"}></i>
            <span>{loading?"Generating...":"Generate Code"}</span>
          </button>
          <button className="secondary" onClick={copyCode} disabled={!generatedChars}>
            <i data-lucide="copy"></i>
            <span>Copy</span>
          </button>
          <button className="secondary" onClick={downloadCode} disabled={!generatedChars}>
            <i data-lucide="download"></i>
            <span>Download</span>
          </button>
          <button className="secondary" onClick={resetEditor}>
            <i data-lucide="rotate-ccw"></i>
            <span>Reset</span>
          </button>
        </div>

        <div className={`progress-container ${loading?"active":""}`}>
          <div className="progress-bar">
            <div className="progress-fill" style={{width:`${progress}%`}}></div>
          </div>
          <div className="progress-text">Generating your code... {progress}%</div>
        </div>
      </div>

      <div className="editor-container">
        <div className="editor-header">
          <div className="editor-title">
            <i data-lucide="code"></i>
            Generated Code
          </div>
          <div className="editor-actions">
            <div style={{fontSize:"0.9rem",color:"#94a3b8",marginRight:"12px"}}>
              Language: <span style={{color:"#6ef3c5",fontWeight:700}}>{language}</span>
            </div>
          </div>
        </div>
        <div id="editor"></div>
        <div className="stats">
          <div className="stat-item">
            <i data-lucide="file-text"></i>
            <span>Characters: <span className="stat-value">{generatedChars.toLocaleString()}</span></span>
          </div>
          <div className="stat-item">
            <i data-lucide="layers"></i>
            <span>Lines: <span className="stat-value">{editorRef.current?editorRef.current.getModel()?.getLineCount()||0:0}</span></span>
          </div>
          <div className="stat-item">
            <i data-lucide="zap"></i>
            <span>Credits Used: <span className="stat-value">{maxCredits-credits}</span></span>
          </div>
        </div>
      </div>

      {toast&&(
        <div className={`toast ${toast.type}`}>
          <i data-lucide={
            toast.type==="success"?"check-circle":
            toast.type==="error"?"x-circle":
            toast.type==="warning"?"alert-triangle":
            "info"
          }></i>
          <span>{toast.msg}</span>
        </div>
      )}

      {modal&&(
        <div className="modal-overlay" onClick={closeModal}>
          <div className={`modal ${modal.type}`} onClick={e=>e.stopPropagation()}>
            <div className="modal-header">
              <div className="modal-icon">
                <i data-lucide={modal.type==="warning"?"alert-triangle":"alert-circle"}></i>
              </div>
              <div className="modal-title">{modal.title}</div>
            </div>
            <div className="modal-body">{modal.body}</div>
            <div className="modal-actions">
              {modal.onConfirm&&(
                <button className="primary" onClick={modal.onConfirm}>
                  <i data-lucide="check"></i>
                  <span>Continue</span>
                </button>
              )}
              <button className="secondary" onClick={closeModal}>
                <i data-lucide="x"></i>
                <span>{modal.onConfirm?"Cancel":"Close"}</span>
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
