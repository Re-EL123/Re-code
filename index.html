<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Re-Code | Re-EL's Advanced Coding AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- React + Babel -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Puter AI -->
<script src="https://js.puter.com/v2/"></script>

<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Monaco Editor -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/editor/editor.main.css" />
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/loader.js"></script>

<!-- Highlight.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<style>
body{margin:0;font-family:Inter,system-ui,sans-serif;background:#0a0e1a;color:#f1f5f9}
.app{max-width:1400px;margin:auto;padding:20px}
header{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.04);padding:16px 24px;border-radius:16px;margin-bottom:20px}
.brand{display:flex;align-items:center;gap:10px;font-size:1.4rem;font-weight:800}
.brand span{color:#6ef3c5}
.badge{padding:6px 12px;border-radius:10px;font-size:.8rem;background:rgba(110,243,197,.15);border:1px solid rgba(110,243,197,.3)}
.panel{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px;margin-bottom:20px}
textarea{width:100%;height:160px;background:#020617;color:#e5e7eb;border-radius:12px;border:1px solid #1e293b;padding:14px;resize:none}
textarea:focus{outline:none;border-color:#6ef3c5}
.actions{display:flex;gap:12px;margin-top:12px}
button{padding:12px 20px;border:none;border-radius:12px;font-weight:700;cursor:pointer}
button.primary{background:linear-gradient(135deg,#6ef3c5,#4ade80);color:#000}
button.secondary{background:#020617;color:#e5e7eb;border:1px solid #1e293b}
button:disabled{opacity:.6;cursor:not-allowed}
#editor{height:420px;border-radius:12px;border:1px solid #1e293b;overflow:hidden}
.stats{display:flex;gap:20px;margin-top:12px;font-size:.85rem;color:#94a3b8}
.toast{position:fixed;bottom:20px;right:20px;background:#020617;border:1px solid #1e293b;padding:14px 20px;border-radius:12px}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useRef}=React;

function cleanCode(raw){
  return raw.replace(/```[\s\S]*?```/g,m=>m.replace(/```[\w]*\n?|```/g,""))
            .replace(/```/g,"")
            .trim();
}

function detectLanguage(code){
  if(code.startsWith("<!DOCTYPE")||code.startsWith("<html"))return"html";
  if(/import React|from 'react'/.test(code))return"javascript";
  if(/def\s+\w+\(/.test(code))return"python";
  if(/System\.out\.print/.test(code))return"java";
  if(/#include\s*</.test(code))return"cpp";
  return"plaintext";
}

function App(){
  const [prompt,setPrompt]=useState("");
  const [loading,setLoading]=useState(false);
  const [credits,setCredits]=useState(100);
  const [toast,setToast]=useState(null);
  const editorRef=useRef(null);
  const monacoRef=useRef(null);

  useEffect(()=>{
    lucide.createIcons();
    require.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}});
    require(["vs/editor/editor.main"],(monaco)=>{
      monacoRef.current=monaco;
      editorRef.current=monaco.editor.create(document.getElementById("editor"),{
        value:"// Generated code will appear here",
        language:"plaintext",
        theme:"vs-dark",
        automaticLayout:true,
        minimap:{enabled:false}
      });
    });
  },[]);

  function showToast(msg){
    setToast(msg);
    setTimeout(()=>setToast(null),3000);
  }

  async function generate(){
    if(!prompt.trim()){showToast("Enter a prompt");return;}
    if(credits<=0){showToast("Credits exhausted");return;}

    setLoading(true);
    let buffer="";
    const system="Return strictly code only. No markdown. No text.";

    try{
      const res=await puter.ai.chat([
        {role:"system",content:system},
        {role:"user",content:prompt}
      ],{model:"claude-sonnet-4-20250514",stream:true});

      for await(const part of res){
        buffer+=part?.text||"";
        const cleaned=cleanCode(buffer);
        editorRef.current.setValue(cleaned);
      }

      // auto-continue if cut off
      if(!/[}\);>]$/.test(buffer.trim())){
        const cont=await puter.ai.chat([
          {role:"system",content:system},
          {role:"user",content:"Continue exactly where you stopped"}
        ],{model:"claude-sonnet-4-20250514",stream:true});

        for await(const part of cont){
          buffer+=part?.text||"";
          editorRef.current.setValue(cleanCode(buffer));
        }
      }

      const final=cleanCode(buffer);
      const lang=detectLanguage(final);
      monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(),lang);

      const cost=Math.ceil(final.length/150);
      setCredits(c=>Math.max(c-cost,0));
      showToast("Generation complete");

    }catch(e){
      showToast("Generation failed");
    }
    setLoading(false);
  }

  return(
    <div className="app">
      <header>
        <div className="brand"><i data-lucide="code-2"></i> Re-Code <span>AI</span></div>
        <div className="badge">Credits: {credits}</div>
      </header>

      <div className="panel">
        <textarea value={prompt} onChange={e=>setPrompt(e.target.value)} placeholder="Describe the code you want..." />
        <div className="actions">
          <button className="primary" onClick={generate} disabled={loading}>{loading?"Generating...":"Generate"}</button>
          <button className="secondary" onClick={()=>navigator.clipboard.writeText(editorRef.current.getValue())}>Copy</button>
        </div>
      </div>

      <div id="editor"></div>

      {toast && <div className="toast">{toast}</div>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
