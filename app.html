<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Re-Code | Re-EL's Advanced Coding AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- React + Babel -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Monaco Editor -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/editor/editor.main.css" />
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs/loader.js"></script>

<style>
/* [Previous CSS unchanged - keeping same styles for brevity] */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,system-ui,sans-serif;background:#0a0e1a;color:#f1f5f9;overflow-x:hidden}
.app{max-width:1800px;margin:auto;padding:20px;position:relative}
.layout{display:grid;grid-template-columns:280px 1fr 420px;gap:20px}

header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);padding:20px 28px;border-radius:20px;margin-bottom:4px;border:1px solid rgba(110,243,197,.2);box-shadow:0 8px 32px rgba(0,0,0,.3);animation:slideDown 0.6s ease}
.brand{display:flex;align-items:center;gap:12px;font-size:1.6rem;font-weight:900;background:linear-gradient(135deg,#6ef3c5,#4ade80);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.brand i{color:#6ef3c5;animation:pulse 2s ease infinite}

.credit-section{display:flex;align-items:center;gap:16px}
.credit-display{display:flex;align-items:center;gap:10px;padding:10px 20px;border-radius:14px;background:rgba(110,243,197,.1);border:2px solid rgba(110,243,197,.3);font-weight:700;font-size:1rem;transition:all 0.3s}
.credit-display.warning{background:rgba(251,191,36,.1);border-color:rgba(251,191,36,.5);animation:warningPulse 1.5s ease infinite}
.credit-display.danger{background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.5);animation:dangerPulse 1s ease infinite}
.credit-bar{width:120px;height:8px;background:#020617;border-radius:10px;overflow:hidden;border:1px solid #1e293b}
.credit-fill{height:100%;background:linear-gradient(90deg,#6ef3c5,#4ade80);transition:all 0.5s ease;border-radius:10px}
.credit-fill.warning{background:linear-gradient(90deg,#fbbf24,#f59e0b)}
.credit-fill.danger{background:linear-gradient(90deg,#ef4444,#dc2626)}

.sidebar{background:rgba(255,255,255,.06);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:20px;box-shadow:0 8px 32px rgba(0,0,0,.3);animation:fadeIn 0.6s ease;max-height:calc(100vh - 140px);overflow-y:auto}
.sidebar-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid rgba(255,255,255,.1)}
.sidebar-title{display:flex;align-items:center;gap:8px;font-weight:700;color:#6ef3c5;font-size:1rem}
.file-list{display:flex;flex-direction:column;gap:8px}
.file-item{padding:12px 14px;background:rgba(2,6,23,.6);border:1px solid #1e293b;border-radius:12px;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:space-between;gap:8px}
.file-item:hover{border-color:#6ef3c5;background:rgba(110,243,197,.05);transform:translateX(4px)}
.file-item.active{border-color:#6ef3c5;background:rgba(110,243,197,.1)}
.file-info{flex:1;min-width:0}
.file-name{font-weight:600;font-size:0.9rem;color:#e5e7eb;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.file-meta{font-size:0.75rem;color:#64748b;margin-top:2px}
.file-actions{display:flex;gap:4px}
.file-btn{padding:6px;background:transparent;border:none;cursor:pointer;color:#94a3b8;border-radius:6px;transition:all 0.2s}
.file-btn:hover{background:rgba(110,243,197,.2);color:#6ef3c5}
.empty-state{text-align:center;padding:40px 20px;color:#64748b;font-size:0.9rem}
.empty-state i{font-size:3rem;margin-bottom:12px;opacity:0.3}

.main-content{display:flex;flex-direction:column;gap:20px}
.main-panel{background:rgba(255,255,255,.06);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:28px;box-shadow:0 8px 32px rgba(0,0,0,.3);animation:fadeIn 0.6s ease}
.prompt-section{position:relative}
.prompt-label{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-weight:600;color:#6ef3c5;font-size:1rem}
textarea{width:100%;min-height:120px;background:rgba(2,6,23,.8);color:#e5e7eb;border-radius:16px;border:2px solid #1e293b;padding:16px;resize:vertical;font-size:0.95rem;line-height:1.6;transition:all 0.3s;font-family:inherit}
textarea:focus{outline:none;border-color:#6ef3c5;box-shadow:0 0 0 3px rgba(110,243,197,.1)}
textarea::placeholder{color:#64748b}

.filename-section{margin-top:12px;display:flex;gap:8px;align-items:center}
.filename-input{flex:1;background:rgba(2,6,23,.8);color:#e5e7eb;border-radius:12px;border:2px solid #1e293b;padding:10px 14px;font-size:0.9rem;transition:all 0.3s}
.filename-input:focus{outline:none;border-color:#6ef3c5;box-shadow:0 0 0 3px rgba(110,243,197,.1)}
.auto-name-btn{padding:10px 16px;background:rgba(110,243,197,.1);border:1px solid rgba(110,243,197,.3);border-radius:10px;color:#6ef3c5;cursor:pointer;font-size:0.85rem;font-weight:600;transition:all 0.3s}
.auto-name-btn:hover{background:rgba(110,243,197,.2);transform:scale(1.02)}

.token-estimate{display:flex;align-items:center;gap:12px;margin-top:12px;padding:12px 16px;background:rgba(110,243,197,.05);border-radius:12px;border:1px solid rgba(110,243,197,.15);font-size:0.9rem;color:#94a3b8}
.token-estimate i{color:#6ef3c5}
.token-cost{font-weight:700;color:#6ef3c5}

.actions{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
button{padding:14px 24px;border:none;border-radius:14px;font-weight:700;cursor:pointer;font-size:0.95rem;display:flex;align-items:center;gap:8px;transition:all 0.3s;position:relative;overflow:hidden}
button:before{content:"";position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,.2);transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s}
button:hover:before{width:300px;height:300px}
button.primary{background:linear-gradient(135deg,#6ef3c5,#4ade80);color:#000;box-shadow:0 4px 16px rgba(110,243,197,.3)}
button.primary:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(110,243,197,.4)}
button.secondary{background:#020617;color:#e5e7eb;border:2px solid #1e293b}
button.secondary:hover{border-color:#6ef3c5;background:#0a1628}
button:disabled{opacity:.5;cursor:not-allowed;transform:none!important}
button i{z-index:1}
button span{z-index:1}

.progress-container{margin-top:16px;display:none}
.progress-container.active{display:block;animation:fadeIn 0.3s}
.progress-bar{width:100%;height:6px;background:#020617;border-radius:10px;overflow:hidden;border:1px solid #1e293b}
.progress-fill{height:100%;background:linear-gradient(90deg,#6ef3c5,#4ade80,#6ef3c5);background-size:200% 100%;animation:progressShimmer 2s linear infinite;transition:width 0.3s}
.progress-text{margin-top:8px;font-size:0.85rem;color:#94a3b8;text-align:center}

.editor-container{background:rgba(255,255,255,.06);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:24px;box-shadow:0 8px 32px rgba(0,0,0,.3);animation:fadeIn 0.8s ease}
.editor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.editor-title{display:flex;align-items:center;gap:8px;font-weight:700;color:#6ef3c5;font-size:1.1rem}
.editor-actions{display:flex;gap:8px}
.icon-btn{padding:10px;border:none;background:rgba(110,243,197,.1);border-radius:10px;cursor:pointer;transition:all 0.3s;color:#6ef3c5;display:flex;align-items:center;justify-content:center}
.icon-btn:hover{background:rgba(110,243,197,.2);transform:scale(1.05)}
.icon-btn:disabled{opacity:.5;cursor:not-allowed}
#editor{height:500px;border-radius:16px;border:2px solid #1e293b;overflow:hidden;box-shadow:inset 0 2px 8px rgba(0,0,0,.3)}

.preview-container{background:rgba(255,255,255,.06);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:24px;box-shadow:0 8px 32px rgba(0,0,0,.3);animation:fadeIn 0.8s ease;display:none}
.preview-container.active{display:block}
.preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.preview-title{display:flex;align-items:center;gap:8px;font-weight:700;color:#6ef3c5;font-size:1.1rem}
#preview-iframe{width:100%;height:450px;border-radius:16px;border:2px solid #1e293b;background:#1a1b26;overflow:hidden;box-shadow:inset 0 2px 8px rgba(0,0,0,.3)}
#preview-console{padding:16px;background:#0f0f23;border-radius:12px;border:1px solid #1e293b;font-family:monospace;font-size:0.8rem;color:#94a3b8;max-height:100px;overflow-y:auto}
.console-line{display:block;margin:2px 0}
.console-error{color:#ef4444}

.stats{display:flex;gap:24px;margin-top:16px;padding:16px;background:rgba(2,6,23,.6);border-radius:12px;border:1px solid #1e293b;flex-wrap:wrap}
.stat-item{display:flex;align-items:center;gap:8px;font-size:0.9rem;color:#94a3b8}
.stat-item i{color:#6ef3c5}
.stat-value{font-weight:700;color:#e5e7eb}

.toast{position:fixed;bottom:24px;right:24px;background:rgba(2,6,23,.95);backdrop-filter:blur(20px);border:2px solid;padding:16px 24px;border-radius:16px;display:flex;align-items:center;gap:12px;font-weight:600;box-shadow:0 8px 32px rgba(0,0,0,.5);animation:slideIn 0.3s ease;z-index:1000;max-width:400px}
.toast.success{border-color:#4ade80;color:#4ade80}
.toast.error{border-color:#ef4444;color:#ef4444}
.toast.warning{border-color:#fbbf24;color:#fbbf24}
.toast.info{border-color:#6ef3c5;color:#6ef3c5}
.toast i{flex-shrink:0}

.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:2000;animation:fadeIn 0.3s}
.modal{background:rgba(2,6,23,.98);border:2px solid;border-radius:20px;padding:32px;max-width:500px;width:90%;box-shadow:0 16px 64px rgba(0,0,0,.7);animation:scaleIn 0.3s ease}
.modal.warning{border-color:#fbbf24}
.modal.danger{border-color:#ef4444}
.modal-header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
.modal-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px}
.modal.warning .modal-icon{background:rgba(251,191,36,.2);color:#fbbf24}
.modal.danger .modal-icon{background:rgba(239,68,68,.2);color:#ef4444}
.modal-title{font-size:1.4rem;font-weight:800}
.modal-body{color:#94a3b8;line-height:1.6;margin-bottom:24px}
.modal-actions{display:flex;gap:12px}

@keyframes slideDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
@keyframes slideIn{from{opacity:0;transform:translateX(100px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
@keyframes warningPulse{0%,100%{box-shadow:0 0 0 0 rgba(251,191,36,.4)}50%{box-shadow:0 0 0 8px rgba(251,191,36,0)}}
@keyframes dangerPulse{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.4)}50%{box-shadow:0 0 0 8px rgba(239,68,68,0)}}
@keyframes progressShimmer{0%{background-position:0% 0}100%{background-position:200% 0}}

@media(max-width:1400px){.layout{grid-template-columns:280px 1fr}}
@media(max-width:1024px){.layout{grid-template-columns:1fr}}
@media(max-width:768px){
  header{flex-direction:column;gap:16px;text-align:center}
  .actions{flex-direction:column}
  button{width:100%;justify-content:center}
  .stats{flex-direction:column;gap:12px}
  #editor{height:400px}
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useRef,useCallback}=React;

const API_KEY = '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';

const storage={
  data:{files:[],credits:1000,activeFileId:null},
  save(){localStorage.setItem('reCodeSession',JSON.stringify(this.data));},
  load(){
    try{
      const saved=localStorage.getItem('reCodeSession');
      if(saved) this.data=JSON.parse(saved);
    }catch(e){}
  }
};

function cleanCode(raw){
  return raw
    .replace(/```[\s\S]*?```/g,'')
    .replace(/I don't see any previous code.*$/s,'')
    .replace(/Could you please share.*$/s,'')
    .replace(/I'll continue.*$/s,'')
    .replace(/Let me continue.*$/s,'')
    .trim();
}

function detectLanguage(code){
  if(!code||code.length<10)return"plaintext";
  if(code.match(/<!DOCTYPE|(<html|(<head|(<body)/i))return"html";
  if(code.match(/import React|from ['"]react['"]|React\./i))return"javascript";
  if(code.match(/def\s+\w+\(|import\s+\w+|print\(/))return"python";
  if(code.match(/System\.out\.print|public\s+class/i))return"java";
  if(code.match(/#include\s*<|using namespace|std::/))return"cpp";
  return code.match(/interface\s+\w+|type\s+\w+\s*=/)?"typescript":"javascript";
}

function generateSmartFilename(prompt,code,lang){
  const keywords=prompt.toLowerCase().match(/\b(calculator|game|chat|form|dashboard|api|app|website|tool)\b/);
  const mainKeyword=keywords?keywords[0]:"code";
  const extensions={javascript:"js",typescript:"ts",html:"html",python:"py",java:"java",cpp:"cpp"};
  const ext=extensions[lang]||"txt";
  return `${mainKeyword}.${ext}`;
}

function estimateTokens(text){return Math.ceil(text.length/4);}
function estimateCost(tokens){return Math.ceil(tokens/50);}

async function* streamOpenRouter(system,prompt){
  const controller=new AbortController();
  const timeoutId=setTimeout(()=>controller.abort(),30000);
  
  try{
    const response=await fetch('https://openrouter.ai/api/v1/chat/completions',{
      method:'POST',
      headers:{
        'Authorization':`Bearer ${API_KEY}`,
        'Content-Type':'application/json',
        'HTTP-Referer':'https://re-code.ai',
        'X-Title':'Re-Code AI'
      },
      body:JSON.stringify({
        model:'anthropic/claude-3.5-sonnet',
        messages:[{role:'system',content:system},{role:'user',content:prompt}],
        stream:true,
        temperature:0.1
      }),
      signal:controller.signal
    });
    
    if(!response.ok){
      const errorText=await response.text();
      throw new Error(`API Error ${response.status}: ${errorText}`);
    }
    
    const reader=response.body?.getReader();
    if(!reader) return;
    
    const decoder=new TextDecoder();
    let buffer="";
    
    try{
      while(true){
        const {done,value}=await reader.read();
        if(done) break;
        
        buffer+=decoder.decode(value,{stream:true});
        const lines=buffer.split('\n');
        buffer=lines.pop()||'';
        
        for(const line of lines){
          if(line.startsWith('data: ')){
            const data=line.slice(6);
            if(data==='[DONE]') continue;
            try{
              const parsed=JSON.parse(data);
              const delta=parsed.choices && parsed.choices[0] && parsed.choices[0].delta && parsed.choices[0].delta.content;
              if(delta) yield delta;
            }catch(e){}
          }
        }
      }
    }finally{
      clearTimeout(timeoutId);
      reader.releaseLock();
    }
  }catch(e){
    clearTimeout(timeoutId);
    throw e;
  }
}

function App(){
  const [prompt,setPrompt]=useState("");
  const [filename,setFilename]=useState("");
  const [loading,setLoading]=useState(false);
  const [credits,setCredits]=useState(1000);
  const [toast,setToast]=useState(null);
  const [modal,setModal]=useState(null);
  const [progress,setProgress]=useState(0);
  const [files,setFiles]=useState([]);
  const [activeFileId,setActiveFileId]=useState(null);
  const [previewActive,setPreviewActive]=useState(false);
  const [previewConsole,setPreviewConsole]=useState([]);
  
  const editorRef=useRef(null);
  const monacoRef=useRef(null);
  const previewRef=useRef(null);
  const activeFile=files.find(f=>f.id===activeFileId);

  useEffect(()=>{
    storage.load();
    if(storage.data.files?.length>0){
      setFiles(storage.data.files);
      setCredits(storage.data.credits||1000);
      if(storage.data.activeFileId) setActiveFileId(storage.data.activeFileId);
    }
    
    lucide.createIcons();
    require.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}});
    require(["vs/editor/editor.main"],(monaco)=>{
      monacoRef.current=monaco;
      editorRef.current=monaco.editor.create(document.getElementById("editor"),{
        value:"// Your generated code will appear here\n// Start by entering a prompt and clicking Generate!",
        language:"plaintext",
        theme:"vs-dark",
        automaticLayout:true,
        minimap:{enabled:false},
        fontSize:14,
        lineHeight:22,
        fontFamily:"'Fira Code', monospace",
        padding:{top:16,bottom:16}
      });
    });
  },[]);

  useEffect(()=>{
    if(activeFile&&editorRef.current){
      editorRef.current.setValue(activeFile.content);
      if(monacoRef.current){
        monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(),activeFile.language);
      }
    }
  },[activeFileId,activeFile]);

  useEffect(()=>{
    storage.data={files,credits,activeFileId};
    storage.save();
  },[files,credits,activeFileId]);

  const showToast=(msg,type="info")=>{
    setToast({msg,type});
    setTimeout(()=>setToast(null),4000);
  };

  const showModal=(title,body,type,onConfirm)=>{
    setModal({title,body,type,onConfirm});
  };

  const closeModal=()=>setModal(null);

  const autoGenerateFilename=()=>{
    if(!prompt.trim()){
      showToast("Enter a prompt first","warning");
      return;
    }
    const tempCode=editorRef.current?.getValue?.()||"";
    const lang=detectLanguage(tempCode);
    const name=generateSmartFilename(prompt,tempCode,lang);
    setFilename(name);
    showToast("Filename generated!","success");
  };

  const estimatedCost=estimateCost(estimateTokens(prompt));
  const creditPercent=(credits/1000)*100;
  const creditStatus=creditPercent<=10?"danger":creditPercent<=30?"warning":"normal";

  const generate=async()=>{
    if(!prompt.trim()){
      showToast("Please enter a prompt","warning");
      return;
    }
    if(credits<=0){
      showModal("No Credits","Reset credits to continue.","danger",null);
      return;
    }
    continueGeneration();
  };

  const continueGeneration=async()=>{
    closeModal();
    setLoading(true);
    setProgress(0);
    
    let buffer="";
    const system=`You are an elite code generation expert. Generate production-ready code:
- Complete working code, NO placeholders
- Proper error handling
- Best practices
- Return ONLY code - no explanations`;

    try{
      const progressInterval=setInterval(()=>setProgress(p=>Math.min(p+2,95)),80);
      
      for await(const text of streamOpenRouter(system,prompt)){
        buffer+=text;
        const cleaned=cleanCode(buffer);
        editorRef.current?.setValue(cleaned);
      }
      
      clearInterval(progressInterval);
      
      const final=cleanCode(buffer);
      const lang=detectLanguage(final);
      if(monacoRef.current && editorRef.current){
        monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(),lang);
      }

      let finalFilename=filename.trim();
      if(!finalFilename){
        finalFilename=generateSmartFilename(prompt,final,lang);
        setFilename(finalFilename);
      }

      const newFile={
        id:Date.now().toString(),
        name:finalFilename,
        content:final,
        language:lang,
        prompt:prompt,
        createdAt:new Date().toISOString(),
        size:final.length
      };

      setFiles(prev=>[newFile,...prev]);
      setActiveFileId(newFile.id);
      const totalCost=Math.ceil(final.length/150);
      setCredits(prev=>Math.max(prev-totalCost,0));
      
      setProgress(100);
      showToast(`"${finalFilename}" created! Used ${totalCost} credits.`,"success");
      setPrompt("");
      setFilename("");
    }catch(e){
      showToast("Generation failed: "+e.message,"error");
    }
    
    setLoading(false);
    setProgress(0);
  };

  const selectFile=id=>{
    setActiveFileId(id);
    lucide.createIcons();
  };

  const deleteFile=(id,e)=>{
    e.stopPropagation();
    showModal("Delete File?","This cannot be undone.","danger",()=>{
      setFiles(prev=>prev.filter(f=>f.id!==id));
      if(activeFileId===id){
        setActiveFileId(null);
        editorRef.current?.setValue("// Select a file or generate new code");
      }
      closeModal();
      showToast("File deleted","info");
    });
  };

  const downloadFile=(id,e)=>{
    e.stopPropagation();
    const file=files.find(f=>f.id===id);
    if(!file) return;
    
    const blob=new Blob([file.content],{type:"text/plain"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download=file.name;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showToast(`"${file.name}" downloaded!`,"success");
  };

  const copyCode=()=>{
    if(!activeFile){
      showToast("No file selected","warning");
      return;
    }
    navigator.clipboard.writeText(activeFile.content).then(()=>{
      showToast("Code copied!","success");
    });
  };

  const togglePreview=()=>{
    if(!activeFile){
      showToast("No file selected","warning");
      return;
    }
    setPreviewActive(!previewActive);
    if(!previewActive) previewCode();
  };

  const previewCode=()=>{
    if(!activeFile || !previewRef.current) return;
    
    setPreviewConsole([]);
    
    try{
      const iframe=previewRef.current;
      iframe.srcdoc="";
      
      if(activeFile.language==="html" || activeFile.name.endsWith('.html')){
        iframe.srcdoc=activeFile.content;
      }else if(activeFile.language==="javascript" || activeFile.name.match(/\.(js|ts)$/)){
        const htmlWrapper=`<!DOCTYPE html>
<html><head><style>body{margin:0;padding:20px;font-family:Arial;background:#1a1b26;color:#e5e7eb}</style></head>
<body><div id="app"></div><script>${activeFile.content}<\/script>
<script>console.log("âœ… Code loaded");</script></body></html>`;
        iframe.srcdoc=htmlWrapper;
      }else{
        iframe.srcdoc=`<!DOCTYPE html>
<html><body style="font-family:monospace;padding:20px;background:#0a0e1a;color:#e5e7eb">
<h2>ðŸ“± Preview (${activeFile.language.toUpperCase()})</h2>
<p>Live preview for HTML/JavaScript only</p>
<pre style="background:#020617;padding:20px;border-radius:12px;overflow:auto">${activeFile.content.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</pre>
</body></html>`;
      }
      
      showToast("Preview loaded","success");
    }catch(e){
      showToast("Preview failed","error");
    }
  };

  const resetCredits=()=>{
    setCredits(1000);
    showToast("Credits reset","success");
  };

  return(
    <div className="app">
      <header>
        <div className="brand">
          <i data-lucide="code-2"></i>
          Re-Code AI <span style={{fontSize:"0.7rem",background:"rgba(110,243,197,.2)",padding:"4px 10px",borderRadius:"8px",marginLeft:"8px",color:"#6ef3c5",fontWeight:600}}>PREMIUM</span>
        </div>
        <div className="credit-section">
          <div className={`credit-display ${creditStatus}`}>
            <i data-lucide="zap"></i> {credits} Credits
          </div>
          <div className="credit-bar">
            <div className={`credit-fill ${creditStatus}`} style={{width:`${creditPercent}%`}}></div>
          </div>
          <button className="icon-btn" onClick={resetCredits} title="Reset Credits">
            <i data-lucide="refresh-cw"></i>
          </button>
        </div>
      </header>

      <div className="layout">
        <aside className="sidebar">
          <div className="sidebar-header">
            <div className="sidebar-title">
              <i data-lucide="folder"></i> Files ({files.length})
            </div>
            {files.length>0&&(
              <button className="icon-btn" onClick={()=>showModal("Clear All?","Cannot be undone.","danger",()=>setFiles([]))} title="Clear All">
                <i data-lucide="trash-2"></i>
              </button>
            )}
          </div>
          
          {files.length===0?(
            <div className="empty-state">
              <i data-lucide="inbox"></i>
              <div>No files yet</div>
              <div style={{fontSize:"0.8rem",marginTop:"8px"}}>Generate code to create files</div>
            </div>
          ):(
            <div className="file-list">
              {files.map(file=>(
                <div key={file.id} className={`file-item ${activeFileId===file.id?"active":""}`} onClick={()=>selectFile(file.id)}>
                  <div className="file-info">
                    <div className="file-name" title={file.name}>{file.name}</div>
                    <div className="file-meta">{(file.size/1000).toFixed(1)}KB â€¢ {file.language}</div>
                  </div>
                  <div className="file-actions">
                    <button className="file-btn" onClick={(e)=>downloadFile(file.id,e)} title="Download">
                      <i data-lucide="download"></i>
                    </button>
                    <button className="file-btn" onClick={(e)=>deleteFile(file.id,e)} title="Delete">
                      <i data-lucide="trash-2"></i>
                    </button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </aside>

        <div className="main-content">
          <div className="main-panel">
            <div className="prompt-section">
              <div className="prompt-label">
                <i data-lucide="message-square"></i>
                What would you like to build?
                <span style={{marginLeft:"auto",fontSize:"0.75rem",background:"rgba(110,243,197,.15)",padding:"4px 10px",borderRadius:"6px",color:"#6ef3c5",display:"flex",alignItems:"center",gap:"4px"}}>
                  <i data-lucide="shield-check" style={{width:"14px",height:"14px"}}></i> Quality Mode
                </span>
              </div>
              <textarea 
                value={prompt} 
                onChange={e=>setPrompt(e.target.value)} 
                placeholder="Create a responsive calculator with gradient design..."
                disabled={loading}
              />
              
              <div className="filename-section">
                <input 
                  type="text" 
                  className="filename-input"
                  value={filename}
                  onChange={e=>setFilename(e.target.value)}
                  placeholder="Filename (auto-generated)"
                  disabled={loading}
                />
                <button className="auto-name-btn" onClick={autoGenerateFilename} disabled={loading}>
                  <i data-lucide="wand-2"></i> Auto
                </button>
              </div>
              
              {prompt&&(
                <div className="token-estimate">
                  <i data-lucide="info"></i>
                  <span>Cost: ~{estimatedCost} credits</span>
                </div>
              )}
            </div>

            <div className="actions">
              <button className="primary" onClick={generate} disabled={loading||!prompt.trim()}>
                <i data-lucide={loading?"loader-2":"sparkles"}></i>
                {loading?"Generating...":"Generate Code"}
              </button>
              <button className="secondary" onClick={copyCode} disabled={!activeFile}>
                <i data-lucide="copy"></i> Copy
              </button>
            </div>

            <div className={`progress-container ${loading?"active":""}`}>
              <div className="progress-bar">
                <div className="progress-fill" style={{width:`${progress}%`}}></div>
              </div>
              <div className="progress-text">Generating... {progress}%</div>
            </div>
          </div>

          <div className="editor-container">
            <div className="editor-header">
              <div className="editor-title">
                <i data-lucide="code"></i>
                {activeFile?.name || "Editor"}
              </div>
              <div className="editor-actions">
                {activeFile&&(
                  <>
                    <span style={{fontSize:"0.9rem",color:"#94a3b8"}}>{activeFile.language}</span>
                    <button className="icon-btn" onClick={togglePreview} title="Preview">
                      <i data-lucide={previewActive?"eye-off":"eye"}></i>
                    </button>
                  </>
                )}
              </div>
            </div>
            <div id="editor"></div>
          </div>
        </div>

        <div className={`preview-container ${previewActive&&activeFile?"active":""}`}>
          <div className="preview-header">
            <div className="preview-title">
              <i data-lucide="monitor"></i> Live Preview
            </div>
            <div className="editor-actions">
              <button className="icon-btn" onClick={previewCode} title="Refresh">
                <i data-lucide="refresh-cw"></i>
              </button>
              <button className="icon-btn" onClick={togglePreview} title="Close">
                <i data-lucide="x"></i>
              </button>
            </div>
          </div>
          <iframe ref={previewRef} id="preview-iframe" title="Preview"/>
        </div>
      </div>

      {toast&&(
        <div className={`toast ${toast.type}`}>
          <i data-lucide={
            toast.type==="success"?"check-circle":
            toast.type==="error"?"x-circle":
            toast.type==="warning"?"alert-triangle":
            "info"
          }></i>
          {toast.msg}
        </div>
      )}

      {modal&&(
        <div className="modal-overlay" onClick={closeModal}>
          <div className={`modal ${modal.type}`} onClick={e=>e.stopPropagation()}>
            <div className="modal-header">
              <div className="modal-icon">
                <i data-lucide={modal.type==="warning"?"alert-triangle":"alert-circle"}></i>
              </div>
              <div className="modal-title">{modal.title}</div>
            </div>
            <div className="modal-body">{modal.body}</div>
            <div className="modal-actions">
              {modal.onConfirm&&<button className="primary" onClick={modal.onConfirm}>Continue</button>}
              <button className="secondary" onClick={closeModal}>Close</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
